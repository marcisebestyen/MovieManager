@page "/edit/{Id:int}"
@rendermode InteractiveServer
@inject MovieService MovieSvc
@inject NavigationManager Navigation

<PageTitle>Edit Movie</PageTitle>

@if (movie == null)
{
    <p><em>Loading movie...</em></p>
}
else
{
    <!-- This H3 is now inside the else block -->
    <h3>Edit: @movie.Title</h3>

    <EditForm Model="movie" OnValidSubmit="HandleValidSubmit" FormName="EditMovie">
        <DataAnnotationsValidator />
        <ValidationSummary class="text-danger" />

        <div class="mb-3">
            <label for="title" class="form-label">Title:</label>
            <InputText id="title" class="form-control" @bind-Value="movie.Title" />
            <ValidationMessage For="@(() => movie.Title)" class="text-danger validation-message" />
        </div>

        <div class="mb-3">
            <label for="director" class="form-label">Director:</label>
            <InputText id="director" class="form-control" @bind-Value="movie.Director" />
            <ValidationMessage For="@(() => movie.Director)" class="text-danger validation-message" />
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="year" class="form-label">Year:</label>
                <InputNumber id="year" class="form-control" @bind-Value="movie.Year" />
                <ValidationMessage For="@(() => movie.Year)" class="text-danger validation-message" />
            </div>
            <div class="col-md-6 mb-3">
                <label for="rating" class="form-label">Rating (0.1 - 10.0):</label>
                <InputNumber id="rating" class="form-control" @bind-Value="movie.Rating" step="0.1" />
                <ValidationMessage For="@(() => movie.Rating)" class="text-danger validation-message" />
            </div>
        </div>

        <div class="mb-3">
            <label for="genre" class="form-label">Genre:</label>
            <InputText id="genre" class="form-control" @bind-Value="movie.Genre" />
            <ValidationMessage For="@(() => movie.Genre)" class="text-danger validation-message" />
        </div>

        <button type="submit" class="btn btn-primary">Save Changes</button>
        <a href="/" class="btn btn-secondary">Cancel</a>
    </EditForm>
}


@code {
    [Parameter]
    public int Id { get; set; }

    private Movie? movie;
    
    protected override async Task OnInitializedAsync()
    {
        movie = await MovieSvc.GetMovieByIdAsync(Id);
    }

    private async Task HandleValidSubmit()
    {
        if (movie != null)
        {
            await MovieSvc.UpdateMovieAsync(movie);
            Navigation.NavigateTo("/");
        }
    }
}
